<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Ocomm">
<!-- 코멘트 추가 -->
	<insert id="o_insertcomm" parameterType="scommbean" >
		insert into ocomment
		values(ocomm_no_seq.nextval, 
			   (select mem_no from member where mem_id=#{mem_id}),
			   #{ocomm_ct},
			   sysdate,
			   ocomm_no_seq.nextval,
			   0,
			   0,
			   #{o_no},
			   #{mem_id})
	</insert>
	<!-- 각 게시글 마다 코멘트 불러오기 -->
	<select id="o_commlist" parameterType="int" resultType="ocommbean">
		select * from ocommlist
		where o_no=#{o_no}
		order by  ocomm_re_ref desc, ocomm_re_seq asc
	</select>
	<!-- 코멘트 삭제 코멘트 댓글이 없는 경우 -->
	<delete id="o_deletecomm" parameterType="java.util.Map">
		delete  ocomment 
		where o_no=#{o_no} and ocomm_no=#{ocomm_no}
	</delete>
	<!-- 코멘트 불러오기 -->
	<select id="o_getcomment" parameterType="ocommbean" resultType="ocommbean">
		select * from ocommlist
		where o_no=#{o_no} and ocomm_no=#{ocomm_no}
	</select>
	<!-- 코멘트에 달린 댓글 확인 -->
	<select id="o_getcommentref" parameterType="ocommbean" resultType="ocommbean">
		select * from ocommlist
		where o_no=#{o_no} and ocomm_re_ref=#{ocomm_no}
	</select>
	<!-- 현재 코멘트에 댓글이 있는 경우 삭제된 코멘트 입니다  -->
	<update id="o_deletecommexistrep" parameterType="java.util.Map">
		update ocomment 
		 set   ocomm_ct='삭제된 코멘트 입니다'
		 where o_no=#{o_no} and ocomm_no=#{ocomm_no}
	</update>
	<!-- 코멘트에 댓글 달기 -->
	<insert id="o_insertcommreply" parameterType="ocommbean">
		insert into ocomment
		values(ocomm_no_seq.nextval, 
				(select mem_no from member where mem_id=#{mem_id}),
			   #{ocomm_ct},
			   sysdate,
			   #{ocomm_re_ref},
			   #{ocomm_re_lev},
			   #{ocomm_re_seq},
			   #{o_no},
			   #{mem_id})
	</insert>
	
</mapper>