<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Sboard">

	<!-- 후기 게시판 글 저장 -->
    <insert id="insertSboard" parameterType="java.util.Map">
      insert into sboard 
          (s_no, s.mem_no, s_sj,   s_ct, 
           s_fl, s_gl, s_rc, s_dt,
           s_lk, s_lkno)
      values(s_no_seq.nextval,#{mem_no},#{bean.s_sj},to_clob(#{bean.s_ct}),
             #{bean.s_fl, jdbcType=VARCHAR}, #{bean.s_gl, jdbcType=VARCHAR},
             ,0,sysdate,0,0)
    </insert>
    
 
    <!-- 후기게시판 멤버 아이디로 멤버 번호 가져오기 -->
    <select id="getmem_no" parameterType="String" resultType="int">
    	select mem_no 
    	from member
    	where #{mem_id}
    </select>
    <!-- 자료실 총 게시물 수 -->
    <select id="sboardcount" resultType="int" >
      select count(*) from sboard 
    </select>
    
    <!-- 후기 게시판 글 목록 (page번호와 limit을 전달받아서 startRow와 endRow를 구함)-->
	<select id="sboardlist"  parameterType="java.util.Map"  resultType="sboardbean">
	    <![CDATA[
		select * 
		from 
		  (select rownum rnum, s_no, mem_id,   s_sj, 
		   s_ct, s_fl,  s_gl,     s_rc,
		   s_dt,  s_lk,   S_lkno 
		   from  
	  	      (select * from sboardlist 
	  	       order by s_no desc)
	  	   ) 
	   	where rnum >= ((#{page}-1) * #{limit}+1)  and rnum <= (#{page} * #{limit})
		]]>
	</select>    
    
    <select id="searchcnt" parameterType="java.util.Map" resultType="int">
    	select count(*) from sboardlist
    	<!-- MyBatis 동적 SQL문 
    		<where>태그는 where절을 반환합니다.
    		<where>안의 하위 태그를 실행하고 반환값이 있으면 where절을 만들어 반환하고 반환값이 없으면 where절을 반환하지 않습니다.
    	 -->
    	 <where>
    	 	<!-- 검색조건이 없는 경우 -->
    	 	<if test="find_field==''">
    	 	</if>
    	 	<!-- 검색 조건이 글쓴이인 경우 -->
    	 	<if test="find_field=='mem_id'">
    	 		mem_id like #{find_name} 
    	 	</if>
    	 	<!-- 검색 조건이 제목인 경우 -->
    	 	<if test="find_field=='s_sj'">
    	 		s_sj like #{find_name}
    	 	</if>
    	 	<!-- 검색 조건이 내용인 경우 -->
    	 	<if test="find_field=='s_ct'">
    	 		s_ct like #{find_name}
    	 	</if>
    	 </where>
    </select>
    
    <select id="sboardlistsearch"  parameterType="java.util.Map"  resultType="bbsbean">
	    
		select * 
		from 
		  (select rownum rnum, s_no, mem_id,   s_sj, 
		   s_ct, s_fl,  s_gl,     s_rc,
		   s_dt,  s_lk,   S_lkno 
		   from  
	  	      (select * from sboardlist 
	  	      <!-- Mybatis 동적 SQL문  -->
		<where>
    	 	<!-- 검색조건이 없는 경우 -->
    	 	<if test="find_field==''">
    	 	</if>
    	 	<!-- 검색 조건이 글쓴이인 경우 -->
    	 	<if test="find_field=='mem_id'">
    	 		mem_id like #{find_name} 
    	 	</if>
    	 	<!-- 검색 조건이 제목인 경우 -->
    	 	<if test="find_field=='s_sj'">
    	 		s_sj like #{find_name}
    	 	</if>
    	 	<!-- 검색 조건이 내용인 경우 -->
    	 	<if test="find_field=='s_ct'">
    	 		s_ct like #{find_name}
    	 	</if>
    	 </where>
	  	       order by s_no desc)
	  	   ) 
	   	where rnum &gt;= ((#{page}-1) * #{limit}+1)  and rnum &lt;= (#{page} * #{limit})
		
	</select>    
	
    <select id="date_order"  parameterType="java.util.Map"  resultType="bbsbean">
	    
		select * 
		from 
		  (select rownum rnum, bbs_num, bbs_name,   bbs_pass, 
		   bbs_subject, bbs_content,  bbs_file,     bbs_re_ref,
		   bbs_re_lev,  bbs_re_seq,   bbs_readcount,bbs_date 
		   from  
	  	      (select * from bbs6 
	  	      <!-- Mybatis 동적 SQL문  -->
		<where>
		<!-- 검색 조건 없는 경우 -->
			<if test="find_field==''">
			</if>
				<!-- 검색 조건이 글쓴이인 경우 -->
    	 	<if test="find_field=='bbs_name'">
    	 		bbs_name like #{find_name}
    	 	</if>
    	 	<!-- 검색 조건이 제목인 경우 -->
    	 	<if test="find_field=='bbs_subject'">
    	 		bbs_subject like #{find_name}
    	 	</if>
    	 	<!-- 검색 조건이 내용인 경우 -->
    	 	<if test="find_field=='bbs_content'">
    	 		bbs_content like #{find_name}
    	 	</if>
		</where>
	  	       order by 
	  	     <choose>
	  	       <when test="orderdate=='asc'"> bbs_date asc)) </when>
	  	       <when test="orderdate=='desc'"> bbs_date desc)) </when>
	  	       <otherwise> bbs_date desc)) </otherwise>
	  	   </choose>    
	  	   
	   	where rnum &gt;= ((#{page}-1) * 10+1)  and rnum &lt;= (#{page} * 10)
		
	</select>    
	
    
    <!-- 자료실 검색 결과 총 게시물 수 -->
    <!-- <select id="bbsfind_cnt1" resultClass="int" 
    parameterClass="String">
      select count(bbs_num) from bbs6 
      where bbs_name like #find_name#  
    </select> -->    
    
    <!-- 자료실 검색 결과 총 게시물 수 -->
    <!-- <select id="bbsfind_cnt2" resultClass="int" 
    parameterClass="String">
      select count(bbs_num) from bbs6
      where bbs_subject like #find_name#
    </select> -->    
    
    <!-- 자료실 검색 결과 총 게시물 수 -->
    <!-- <select id="bbsfind_cnt3" resultClass="int" 
    parameterClass="String">
      select count(bbs_num) from bbs6 
      where bbs_content like #find_name#  
    </select>  -->   
    
    <!-- 자료실 내용 가져오기 -->
    <select id="sboardcont" resultType="sboardbean" parameterType="int">
      select * from sboard where s_no=#{num}
    </select>
    
    <!-- 조회수 증가 -->
    <update id="sboardhit" parameterType="int">
      update sboard 
         set s_rc=s_rc+1 
       where s_no=#{num}
    </update>
    
    <!-- 자료실 수정 -->
    <update id="sboardedit" parameterType="java.util.Map">
     update sbaord 
        set mem_no=#{mem_no}, s_sj=#{bean.s_sj},
            s_ct=#{bean.s_ct}, s_fl=#{bean.s_fl, jdbcType=VARCHAR}
      where s_no=#{bean.s_no}
    </update>
    
    <!-- 자료실 삭제 -->
    <delete id="sboarddelete" parameterType="int">
      delete 
      from   sboard 
      where  s_no=#{s_no}
    </delete>
    
    <!-- 답변글 레벨 증가 -->
    <update id="bbs_Level" parameterType="bbsbean">
        update bbs6 
           set bbs_re_seq=bbs_re_seq+1
		 where bbs_re_ref=#{bbs_re_ref}  and bbs_re_seq > #{bbs_re_seq}
    </update>
    
    <!-- 답변글 저장 -->
    <insert id="bbs_reply" parameterType="bbsbean">   
       insert into bbs6( 
              bbs_num, bbs_name,  bbs_subject,bbs_content,
              bbs_pass,bbs_re_ref,bbs_re_lev, bbs_re_seq,
              bbs_readcount,      bbs_date) 
       values(
              bbs6_num_seq.nextval,#{bbs_name},#{bbs_subject},
              #{bbs_content},#{bbs_pass},#{bbs_re_ref},#{bbs_re_lev},
              #{bbs_re_seq},0,sysdate)
    </insert>
    
    
</mapper>






















